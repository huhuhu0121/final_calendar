<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이번 달 달력</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .navbar {
            transition: background-color 0.3s, color 0.3s;
        }
        .calendar {
            max-width: 900px;
            margin: 0 auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.3s;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            transition: background-color 0.3s, color 0.3s;
        }
        .calendar-header h2 {
            margin: 0;
        }
        .calendar-header button {
            border: none;
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .calendar-header button:disabled {
            background-color: #ccc;
        }
        .calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-gap: 1px;
        }
        .calendar-day {
            padding: 10px;
            text-align: right;
            border: 1px solid #ddd;
            box-sizing: border-box;
            cursor: pointer;
            position: relative;
            aspect-ratio: 1; /* 날짜 칸 정사각형 유지 */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .calendar-day-header {
            font-weight: bold;
            text-align: center;
            padding: 5px 0;
            aspect-ratio: 3; /* 요일 칸의 비율 조정 */
        }
        .calendar-day:hover {
            background-color: #e7f1ff;
        }
        .calendar-day.selected {
            background-color: #007bff;
            color: white;
        }
        .calendar-day.today {
            background-color: #ffffe0; /* 옅은 노란색 배경 */
        }
        .calendar-day .event-count {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 0.75em;
            color: #007bff;
        }
        .nav-tabs .nav-link {
            color: #007bff;
        }
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
        }
        /* 다크 모드 스타일 */
        .dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        .dark-mode .navbar {
            background-color: #333;
            color: #e0e0e0;
        }
        .dark-mode .calendar {
            border-color: #444;
        }
        .dark-mode .calendar-header {
            background-color: #333;
            color: #e0e0e0;
        }
        .dark-mode .calendar-header button {
            background-color: #555;
        }
        .dark-mode .calendar-day {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-color: #333;
        }
        .dark-mode .calendar-day:hover {
            background-color: #333;
        }
        .dark-mode .calendar-day.selected {
            background-color: #007bff;
            color: #fff;
        }
        .dark-mode .calendar-day.today {
            background-color: #2a2a2a;
        }
        .dark-mode .calendar-day .event-count {
            color: #007bff;
        }
        .dark-mode .nav-tabs .nav-link {
            color: #e0e0e0;
        }
        .dark-mode .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: #fff;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-light">
    <div class="ml-auto d-flex">
        <a class="navbar-brand mr-3" href="#">님의 캘린더</a>
        <a class="nav-link" href="#">로그아웃</a>
        <button id="toggleModeButton" class="btn btn-secondary ml-2">◐</button>
    </div>
</nav>

<div class="calendar">
    <div class="calendar-header">
        <button id="prevMonth">이전</button>
        <h2 id="monthYear"></h2>
        <button id="nextMonth">다음</button>
    </div>
    <div class="calendar-body" id="calendarBody">
        <!-- 달력의 날짜들이 여기에 표시됩니다 -->
    </div>
</div>

<!-- 일정 및 루틴 추가 모달 -->
<div class="modal fade" id="routineModal" tabindex="-1" role="dialog" aria-labelledby="routineModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="routineModalLabel">일정/루틴 추가</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="schedule-tab" data-toggle="tab" href="#schedule" role="tab" aria-controls="schedule" aria-selected="true">일정</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="routine-tab" data-toggle="tab" href="#routine" role="tab" aria-controls="routine" aria-selected="false">루틴</a>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <!-- 일정 추가 탭 -->
                    <div class="tab-pane fade show active" id="schedule" role="tabpanel" aria-labelledby="schedule-tab">
                        <form id="scheduleForm">
                            <div class="form-group">
                                <label for="scheduleTitle">일정 제목</label>
                                <input type="text" class="form-control" id="scheduleTitle" required>
                            </div>
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="allDay">
                                <label class="form-check-label" for="allDay">하루 종일</label>
                            </div>
                            <div class="form-group">
                                <label for="scheduleStartDate">시작 날짜</label>
                                <input type="date" class="form-control" id="scheduleStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="scheduleEndDate">종료 날짜</label>
                                <input type="date" class="form-control" id="scheduleEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="scheduleDetails">일정 내용</label>
                                <textarea class="form-control" id="scheduleDetails" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="scheduleParticipants">참석자</label>
                                <input type="text" class="form-control" id="scheduleParticipants">
                            </div>
                            <div class="form-group">
                                <label for="scheduleLocation">장소</label>
                                <input type="text" class="form-control" id="scheduleLocation">
                            </div>
                        </form>
                    </div>

                    <!-- 루틴 추가 탭 -->
                    <div class="tab-pane fade" id="routine" role="tabpanel" aria-labelledby="routine-tab">
                        <form id="routineForm">
                            <div class="form-group">
                                <label for="routineTitle">루틴 제목</label>
                                <input type="text" class="form-control" id="routineTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="routineStartDate">루틴 시작일</label>
                                <input type="date" class="form-control" id="routineStartDate" required>
                            </div>
                            <div class="form-group">
                                <label for="routineEndDate">루틴 종료일</label>
                                <input type="date" class="form-control" id="routineEndDate" required>
                            </div>
                            <div class="form-group">
                                <label for="routinePattern">반복 패턴</label>
                                <select class="form-control" id="routinePattern">
                                    <option value="daily">매일</option>
                                    <option value="weekly">매주</option>
                                    <option value="monthly">매월</option>
                                    <option value="yearly">매년</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="routineTime">시간</label>
                                <input type="time" class="form-control" id="routineTime">
                            </div>
                            <div class="form-group form-check">
                                <input type="checkbox" class="form-check-input" id="manualEntry">
                                <label class="form-check-label" for="manualEntry">수동 등록</label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" id="saveRoutine">저장</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    const calendarBody = document.getElementById('calendarBody');
    const monthYear = document.getElementById('monthYear');
    const prevMonthButton = document.getElementById('prevMonth');
    const nextMonthButton = document.getElementById('nextMonth');
    const routineModal = new bootstrap.Modal(document.getElementById('routineModal'));
    const saveRoutineButton = document.getElementById('saveRoutine');
    const toggleModeButton = document.getElementById('toggleModeButton');
    let selectedDateElement = null;
    let selectedDate = null;

    let currentDate = new Date();
    let isDarkMode = false;

    function renderCalendar(date) {
        const month = date.getMonth();
        const year = date.getFullYear();
        const today = new Date();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        monthYear.textContent = `${year}년 ${month + 1}월`;

        calendarBody.innerHTML = '';

        const daysOfWeek = ['일', '월', '화', '수', '목', '금', '토'];
        daysOfWeek.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day calendar-day-header';
            dayHeader.textContent = day;
            calendarBody.appendChild(dayHeader);
        });

        for (let i = 0; i < firstDay.getDay(); i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day';
            calendarBody.appendChild(emptyDay);
        }

        for (let day = 1; day <= lastDay.getDate(); day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = day;
            dayElement.dataset.date = `${year}-${month + 1}-${day}`;

            // 오늘 날짜에 해당하는 경우 클래스 추가
            if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                dayElement.classList.add('today');
            }

            dayElement.addEventListener('click', function() {
                if (selectedDateElement) {
                    selectedDateElement.classList.remove('selected');
                }
                selectedDateElement = dayElement;
                dayElement.classList.add('selected');

                // 선택한 날짜를 기록
                selectedDate = dayElement.dataset.date;

                // 일정을 클릭한 날짜에 맞게 세팅
                document.getElementById('scheduleStartDate').value = selectedDate;
                document.getElementById('scheduleEndDate').value = selectedDate;
                document.getElementById('routineStartDate').value = selectedDate;
                document.getElementById('routineEndDate').value = selectedDate;

                // 모달 보여주기
                $('#routineModal').modal('show');
            });
            calendarBody.appendChild(dayElement);
        }
    }

    function toggleMode() {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode', isDarkMode);
        toggleModeButton.textContent = isDarkMode ? '◑' : '◐';
    }

    prevMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    nextMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    saveRoutineButton.addEventListener('click', () => {
        const activeTab = document.querySelector('.nav-link.active').getAttribute('id');

        if (activeTab === 'schedule-tab') {
            const title = document.getElementById('scheduleTitle').value;
            const startDate = document.getElementById('scheduleStartDate').value;
            const endDate = document.getElementById('scheduleEndDate').value;
            const details = document.getElementById('scheduleDetails').value;
            const participants = document.getElementById('scheduleParticipants').value;
            const location = document.getElementById('scheduleLocation').value;
            const allDay = document.getElementById('allDay').checked;

            if (title && startDate && endDate) {
                alert(`일정 추가됨: ${title} (${startDate} - ${endDate})\n하루 종일: ${allDay}`);
                $('#routineModal').modal('hide');
                // 여기에 일정을 저장하는 로직 추가
            } else {
                alert('제목, 시작 날짜, 종료 날짜를 입력하세요.');
            }
        } else if (activeTab === 'routine-tab') {
            const title = document.getElementById('routineTitle').value;
            const startDate = document.getElementById('routineStartDate').value;
            const endDate = document.getElementById('routineEndDate').value;
            const pattern = document.getElementById('routinePattern').value;
            const time = document.getElementById('routineTime').value;
            const manualEntry = document.getElementById('manualEntry').checked;

            if (title && startDate && endDate) {
                alert(`루틴 추가됨: ${title} (${startDate} - ${endDate})\n반복 패턴: ${pattern}\n시간: ${time}\n수동 등록: ${manualEntry}`);
                $('#routineModal').modal('hide');
                // 여기에 루틴을 저장하는 로직 추가
            } else {
                alert('제목, 시작일, 종료일을 입력하세요.');
            }
        }
    });

    // 모달이 열릴 때 폼 내용 초기화
    $('#routineModal').on('shown.bs.modal', function () {
        // 폼을 직접 초기화하여 날짜를 제외한 모든 필드를 리셋
        document.getElementById('scheduleTitle').value = '';
        document.getElementById('scheduleStartDate').value = '';
        document.getElementById('scheduleEndDate').value = '';
        document.getElementById('scheduleDetails').value = '';
        document.getElementById('scheduleParticipants').value = '';
        document.getElementById('scheduleLocation').value = '';
        document.getElementById('allDay').checked = false;
        document.getElementById('routineTitle').value = '';
        document.getElementById('routineStartDate').value = '';
        document.getElementById('routineEndDate').value = '';
        document.getElementById('routinePattern').value = 'daily';
        document.getElementById('routineTime').value = '';
        document.getElementById('manualEntry').checked = false;
    });

    // 다크 모드/라이트 모드 버튼 클릭 처리
    toggleModeButton.addEventListener('click', toggleMode);

    renderCalendar(currentDate);
</script>
</body>
</html>
